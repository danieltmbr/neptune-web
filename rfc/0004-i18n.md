- Start Date: 2020-10-13
- Status:

# Summary

Some of Neptune Web components have default and/or hardcoded messages which needs to be localised.

In this RFC we describe proposal using [react-intl](https://formatjs.io/docs/react-intl) library, Crowdin along with a custom context provider component.

# Motivation

Components have text that is not likely to be changed, text that we are able to anticipate, optional text that has a default value. Those cases are not that many but we still have them and at the moment they are not localised at all:

- The `aria-label` on a `CloseButton` ("Close"); next and previous buttons in a `Pagination` component ("Previous" and "Next").
- Messages in `Upload` component.
- Default validation messages in `Field`.


# Technical Details

We propose to use react-intl library as API for managing translations of Neptune Web components with Crowdin integration in neptune-web repo for receiving new translated copies plus custom context provider that we called `NeptuneProvider` (for now this provide will only handle translations but in future it might be enhanced to handle also other global configurations (e.g Theming via `theme` prop)).

We decided to add `NeptuneProvider` on top of react-intl in order to decouple consumer's applications from a specific translation library. So consumers can continue using their existing translation with what ever setup they have either it's React only Angular & React hybrid application it still will work.

[Here you can see implementation of the provider](https://github.com/transferwise/neptune-web/blob/translation-react-intl/packages/components/src/common/neptuneProvider/NeptuneProvider.js). Setup of react-intl is based on [example from their docs](https://formatjs.io/docs/react-intl/components/#rawintlprovider).

Rough example using react-inl in component's code:

```js
import { useIntl, FormattedMessage } from 'react-intl';

export const SomeComponent = ({ children, ... }) => {
  // Once you've wrapped your code in RawIntlProvider,
  // you can get access to the `intl` object via calling this hook in your functional components
  const intl = useIntl();
  return (
    <button
      aria-label={intl.formatMessage({ id: 'some.message.key' })}
      ...
    >
      <FormattedMessage key="another.message.key">
      {children}
    </button>
  );
};
```

On consumer side you should wrap area where you use Neptune components in the provider (usually it's at the top level component, just like you do with other context providers), rough example:

```js
class App {
  render() {
    return (
      <NeptuneProvider locale={'en'}>
        <Head>
          <title>...</title>
        </Head>
        ...
      </NeptuneProvider>
    );
  }
}
```

Example of usage in Storybook:

```js
addDecorator(...);
addDecorator((storyFn) => <NeptuneProvider locale="en">{storyFn()}</NeptuneProvider>);
```



`NeptuneProvider` can be defined next to other context providers of other libraries or even react-intl.

We plan add CI job for PR branches which will push translations to Crowdin only when [job is approved](https://circleci.com/docs/2.0/workflows/#holding-a-workflow-for-a-manual-approval).
So while contributor finishing their changes Translators already working on translations for new messages thus we can publish new message with it's all translations all together avoiding subsequent PR merge & version update.

# Patterns & Conventions

Proposing keep length of message keys as short as possible because they don't get minified so those things will add weight to the end bundle. Example of key:

```
np.c9n.btn.close.aria.lbl
```

Where `np.c9n.` is mandatory unique prefix, `np` stands for Neptune and `c9n` is a shorthand for name of component which this message belong to ('CloseButton' in this case).
So for 'Pagination' it will be `p8n`, 'Summary' - `s5y` and so on.

Try to use shorthand when ever possible without sacrificing readability e.g choose 'btn' over 'button', 'lbl' over 'label' etc.

Those rules aren't enforced they just general suggestion.

# Misc

### Supported Languages

Same as other TransferWise Web app/libraries.

German (de), UK Englishv (en), US English (en-US), Spanish (es),
French (fr), Hungarian (hu), Italian (it), Japanese (ja), Polish (pl), Brazilian Portuguese (pt)
Romanian (ro), Russian (ru), Turkish (tr), Hong Kong Chinese (zh_HK).
