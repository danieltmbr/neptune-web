- Start Date: 2020-10-15
- Status: Progress

# Summary

Some of Neptune Web components have default and/or constant messages which needs to be localised.

This RFC describes a proposal using [react-intl](https://formatjs.io/docs/react-intl) library and Crowdin along with a custom context provider. This solution will be compatible with React or React + Angular hybrid apps/libraries.

Note: all changes in code are not a final version, they are for demo and proof of concept purposes.

# Motivation

Some of neptune web components required translations for 'default text' where we define 'default text':
 - text that is not likely to be changed.
 - text that we are able to anticipate.
 - optional text that has a default value.

Currently we don't have many occurences of such strings but we need a scalable solution to handle more in future.

Some examples of 'default text' that need to be translated are:
- `aria-label` in `CloseButton` ("Close");
- `next` and `previous` button text in  `Pagination` component ("Previous" and "Next").
- default messages in `Upload` component.
- validation messages in `Field`.

# Technical Details

This RFC suggests to use:
- react-intl as API for managing translations inside components
- Crowdin as a translation vendor for neptune-web repository.
- A Custom context provider that we called `NeptuneProvider`.

`NeptuneProvider` for now will only handle translations but in future it could also handle other global configurations for example theming. Its main duty is to initialize `react-intl` on the consumer side.
[Here](https://github.com/transferwise/neptune-web/blob/translation-react-intl/packages/components/src/common/neptuneProvider/NeptuneProvider.js) you can see an initial implementation of the provider. The setup of `react-intl` follows the example from the [offcical docs](https://formatjs.io/docs/react-intl/components/#rawintlprvider).
`NeptuneProvider` can also be nested inside other providers.

# Usage examples

## Neptune web usage

```js
import { useIntl, FormattedMessage } from 'react-intl';

export const SomeComponent = ({ children, ... }) => {
  // Once the component is wrapped in RawIntlProvider, via NeptuneProvider,
  // it can access the `intl` object via the `useIntl` hook.
  const intl = useIntl();
  return (
    <button
      aria-label={intl.formatMessage({ id: 'some.message' })}
      ...
    >
      <FormattedMessage id="random.message" />
      {children}
    </button>
  );
};
```

## Consumers app usage

Consumers needs to wrap Neptune components in the `NeptuneProvider`. Usually this should be done at root level.

```js
class App {
  render() {
    return (
      <NeptuneProvider locale={'en'}>
        <Head>
          <title>...</title>
        </Head>
        ...
      </NeptuneProvider>
    );
  }
}
```

## Playground usage

For example if you are using Storybook as playground it is possible to setup the env just adding a decorator that wraps your story with neptune provider.

```js
// This example with Storybook v5
addDecorator(...);
addDecorator((storyFn) => <NeptuneProvider locale="en">{storyFn()}</NeptuneProvider>);
```

# Crowdin integration

A Circle job is going to be added to the current workflow of PR branches. This job is going to take care of translations pushes to Crowdin ([see job example](https://app.circleci.com/pipelines/github/transferwise/neptune-web/5336/workflows/72e0c371-d39f-44cf-8933-20859a0c6b00)). 
Contributors have to manually approve this job ([Holding a Workflow/Job for a Manual Approval](https://circleci.com/docs/2.0/workflows/#holding-a-workflow-for-a-manual-approval)) to trigger it they want push messages for translations.
Having this job as part of PR branch will allow Translators start working on the translations in parallel with the developers that can keep working on their changes. Ideally all PRs should be merged once all the translations are provided, to reduce the number of merges and consequent version bumps.

# Message Key Naming Convention

When writing message's keys please follow the convention:

```
[np].[ComponentName].[elementName]...
```

where:
- `[np]` - stands for Neptune;
- `[ComponentName]` - component name (e.g `CloseButton`, `Pagination` etc.);
- `[elementName]` - element that receive the translation;

Each part of the key should be separated by dot.

To safe a bit of bundle file size we plan to use [`babel-plugin-react-intl-id-hash`](https://www.npmjs.com/package/babel-plugin-react-intl-id-hash) will be used to rewrite and shorten message keys.

# Supported Languages

Same as other TransferWise Web app/libraries.

- German (de)
- UK English (en)
- US English (en-US)
- Spanish (es)
- French (fr)
- Hungarian (hu)
- Italian (it)
- Japanese (ja)
- Polish (pl)
- Brazilian Portuguese (pt)
- Romanian (ro)
- Russian (ru)
- Turkish (tr)
- Hong Kong Chinese (zh-HK)

# Considerations

- We did consider implementing approach that is described in react-intl docs - [Distributing i18n-friendly libraries](https://formatjs.io/docs/guides/distribute-libraries/), but we found it not so suitable for us as it forces consumer applications use react-intl with some extra configs on consumer side. 
